---
title: "ESM 205 Assignment 5"
author: "Derek Nguyen and Bobby Miyashiro"
date: "12/04/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE)
```


```{r,  echo = FALSE, include = FALSE, warning = FALSE}
library(tidyverse)
library(effsize)
library(janitor)
library(tidyr)
library(tidyr)
library(kableExtra)
library(car)
library(ggbeeswarm)
library(ggridges)
```

INTRODUCTION




Citation: Gregory S. V. 2016. Aquatic Vertebrate Population Study in Mack Creek, Andrews Experimental Forest, 1987 to present. Environmental Data Initiative. https://doi.org/10.6073/pasta/5de64af9c11579266ef20da2ff32f702. Dataset accessed 11/19/2019.

![](mander.jpeg)

***Figure 1: Pacific Giant Salamander 'Dicamptodon tenebrosus'.*** *Pacific Giant Salamander chilling on a bed of leaves. (Credit: [Wikipedia](https://en.wikipedia.org/wiki/Pacific_giant_salamander))*

![](mack.png) 
***Figure 2: Mack Creek, Andrews Experimental Forest.*** *Spacial Coverage of Study Site. (Credit: [LTER](https://portal.lternet.edu/nis/mapbrowse?scope=knb-lter-and&identifier=4027&revision=13))*


```{r,echo=FALSE, warning=FALSE, include = FALSE}
mack_creek_vert <- readr::read_csv("mack_creek_vertebrates.csv") %>% 
  clean_names() %>% 
  select(-pitnumber, -notes, -length2)
```

A. Visually compare annual salamander counts in old growth (OG) and clear cut (CC) sections of Mack Creek...

```{r, echo = FALSE}
mack_creek_dite <- mack_creek_vert %>% 
  filter(species %in% "DITE") %>% 
  count(year, section)

mack_creek_dite_table <- mack_creek_dite %>% 
  pivot_wider(names_from = section, values_from = n)
```

```{r, echo = FALSE}
ggplot(data = mack_creek_dite, aes(x = year, y = n, fill = section)) +
  geom_col(alpha = .8) +
  facet_wrap(~section) +
  scale_x_continuous(expand = c(0,0)) +
  scale_y_continuous(expand = c(0,0)) +
  theme_dark() +
  labs(y = "Total Counts",
       fill = "Section",
       x = "Year")
```

***Figure 3: Annual Salamander Counts in Old Growth (OG) & Clear Cut (CC) Forests along Mack Creek.*** *Counts of Pacific Giant Salamander in clear cut forest and old growth forest sections along Mack Creek are shown from 1993 through 2017. Data [Gregory S.V. 2016](https://doi.org/10.6073/pasta/5de64af9c11579266ef20da2ff32f702]*

Observations of Pacific Giant Salamander's along Mack Creek are compared between the old growth sections and clear cut sections between the years of 1993 and 2017. As shown in Figure 3, the overall graph shapes and counts are very similar between the two different sections between the years. General trends along both graphs show that there was an increase in observation counts during the year 2002. There was a decrease in counts during 2014 and then the counts then increased again after that. These trends are consistent across both creek sections, indicating that there may not be a difference in Pacific Giant Salamander's ability to survive in the two different habitat types.
```{r, echo = FALSE}
ggplot(data = mack_creek_dite, aes(x = year, y = n)) +
  geom_line(color = "orange") +
  facet_wrap(~section) +
  scale_x_continuous(expand = c(0,0)) +
  theme_dark() +
  labs(y = "Total Counts",
       title = "Annual Salamander Counts in Old Growth (OG) & Clear Cut (CC)",
       caption = "1993 - 2017",
       x = NULL)
```

B. Table of 2017 salamander counts by channel classification (pool, cascades and side-channel) in old growth (OG) and clear cut (CC) sections of Mack Creek...

```{r, echo = FALSE}
#Get the counts....
mack_creek_counts <- mack_creek_vert %>% 
  filter(unittype %in% c("P", "C", "SC")) %>% 
  filter(species %in% "DITE") %>% 
  filter(year == "2017") %>% 
  filter(section %in% c("CC", "OG")) %>% 
  count(unittype, species, year, section) %>% 
  group_by(unittype, section) %>% 
  summarize(counts = sum(n)) %>% 
  pivot_wider(names_from = unittype, values_from = counts) %>% 
  rename("Pool" = P,
         "Cascades" = C,
         "Side Channel" = SC,
         "Section" = section)

mack_creek_counts

  
  




```
 

***Table 1: 2017 Pacific Giant Salamander Counts by Channel Classification in Mack Creek*** *Pacific Giant Salamander counts along clear cut and old growth forest sections of Mack Creek. Mack Creek is further separated by channel classifications into cascades, pool, and side channel. The most Pacific Giant Salamander counts were made along the cascades channel classification of Mack Creek for both the clear cut and old growth sections. The least Pacific Giant Salamander counts were made along the pool channel classifications of Mack Creek.*
```{r, echo = FALSE, warning = FALSE, message = FALSE}
mack_creek_props <- mack_creek_counts %>% 
  adorn_percentages(denominator = "row") %>% 
  adorn_pct_formatting(digits = 1) %>% 
  adorn_ns(position = "front")

mack_creek_props$Section <- gsub("CC", "Clear Cut", mack_creek_props$Section)
mack_creek_props$Section <- gsub("OG", "Old Growth", mack_creek_props$Section)


kable(mack_creek_props) %>% 
  kable_styling(bootstrap_options = "striped", 
                full_width = F,
                position = "center") %>% 
  row_spec(c(1:2),
                   color = "navy")



```


C.  Is there a significant difference in where in the channel Pacific giant salamanders are located (pool, cascade or side channel) between the two sections (old growth and clear cut)? 

```{r}
chi_test_location <- mack_creek_counts %>% 
  select(-Section)

chi_test_location
```


```{r}
chi_test_channel <- chisq.test(chi_test_location)

chi_test_channel
```


H0: Is there a significant difference in where pacific giant salamanders are located between the two sections? 

HA: There is no significant difference....



D. Compare weights of Pacific giant salamanders in clear cut and old growth forest sections of the creek in 2017

```{r}
section_mack_creek_weight <- mack_creek_vert %>% 
  select(year, species, section, weight) %>% 
  filter(year %in% "2017",
         species %in% "DITE") %>% 
  group_by(section) %>% 
  summarize(mean_weight = mean(weight, na.rm = TRUE),
            sd_weight = sd(weight, na.rm = TRUE),
            sample_size = n())

section_mack_creek_weight$section <- gsub("OG", "Old growth", section_mack_creek_weight$section)
section_mack_creek_weight$section <- gsub("CC", "Clear cut", section_mack_creek_weight$section)

kable(section_mack_creek_weight) %>% 
  kable_styling(bootstrap_options = "striped", 
                full_width = F,
                position = "center") %>% 
  row_spec(c(1:2),
                   color = "purple")



```

Is there a significant difference in mean weights for Pacific giant salamanders observed in the two forest sections (clear cut and old growth) in 2017? 
 
```{r}
weight_ttest <- t.test(section_mack_creek_weight$mean_weight)

weight_ttest
```





E. Compare weights of Pacific giant salamanders in pools, cascades and side-channels of Mack Creek in 2017...

First,
```{r}
mack_creek_weight_unit <- mack_creek_vert %>% 
  filter(year %in% "2017",
         species %in% "DITE",
         unittype %in% c("P", "C", "SC")) %>% 
  group_by(unittype) 
```



```{r}
summary_mack_creek_weight_unit <- mack_creek_weight_unit %>% 
  summarize(mean_weight = mean(weight, na.rm = TRUE),
            sd_weight = sd(weight, na.rm = TRUE),
            sample_size = n(),
            se_weight = sd((weight) / sqrt(n()), (na.rm = TRUE)),
            var_weight = var(weight, na.rm = TRUE))

summary_mack_creek_weight_unit$unittype <- gsub("C", "Cascade", summary_mack_creek_weight_unit$unittype)
summary_mack_creek_weight_unit$unittype <- gsub("P", "Pool", summary_mack_creek_weight_unit$unittype)

summary_mack_creek_weight_unit$unittype <- gsub("SC", "Side-Channel", summary_mack_creek_weight_unit$unittype)

kable(summary_mack_creek_weight_unit) %>% 
  kable_styling(bootstrap_options = "striped", 
                full_width = F,
                position = "center") %>% 
  row_spec(c(1:3),
                   color = "purple")

summary_mack_creek_weight_unit

```

```{r}
pd <- position_dodge(width = 0.4)
```


```{r}
ggplot() +
  geom_beeswarm(data = mack_creek_weight_unit,
                aes(x = unittype,
                    y = weight,
                    color = unittype
                    ),
                show.legend = FALSE,
                size = 1.4,
                alpha = 0.6,
                position = pd) +
  geom_point(data = summary_mack_creek_weight_unit, aes(x = unittype, y = mean_weight), position = pd) +
  labs(x = "Unit Type",
       y = "Weight (grams)",
       title = "Pacific Giant Salamander Weights between the Three Channels",
       caption = "Weight comparison for 2017") +
 
  scale_x_discrete(labels = c("Pool", "Cascades", "Side-channel")) +
  theme_dark() 
```

```{r}
ggplot(data = mack_creek_weight_unit, aes(x = unittype, y = weight, color = unittype)) +
geom_violin(aes(color = unittype, fill = ""),
            alpha = 0.5) +
  geom_jitter()  +
  theme_dark()
  
```


```{r}
ggplot(data = mack_creek_weight_unit, aes(x = weight,
                                          y = unittype)) +
  geom_density_ridges(aes(color = unittype, fill = unittype, alpha = 0.6),
                      show.legend = FALSE) +
  scale_x_continuous(expand = c(0,0))  +
  theme_dark() +
  labs(x = "Weight (grams)",
       y = "Unit-type",
       title = "Pacific Salamander Weights Across 3 Channels")

mack_creek_weight_unit 
```


SEcond, Is there a significant difference in mean weights for Pacific giant salamanders observed in pools vs. cascades vs. side-channels in 2017?

- 


Third, describe any concerns you have about comparing means across the groups. What might be another option to consider moving forward with the analysis

